function tourJS(a){var b={curStop:0,offsetFudge:15,allowSkip:false,funnelID:"tourV1",init:function(){window.tourActive=true;$("body").prepend('<div id="tour_mask"></div><div id="tour_dialog"><div class="arrow top"></div><div class="msg"></div></div>');this.showStep()},nextStep:function(){var b=a[this.curStop].waitForTrigger;this.curStop+=1;this.curStop<a.length&&!b?this.showStep():this.tourComplete()},showStep:function(){var b=this;this.setupSelectorsLive();$(".tour_item").removeClass("active");this.getContent();this.setDialogPos(a[this.curStop].position);$("*").bind("click",{stop:this.curStop},this.tourClickHandler);if(!$("#tour_mask").is(":visible")){$("#tour_mask").fadeIn()}$(a[this.curStop].selector).addClass("active").fadeIn();$("#tour_dialog").fadeIn(function(){b.dialogVisible()})},stepComplete:function(){this.mpEvent(a[this.curStop].actionName);$("*").unbind("click",this.tourClickHandler);var b=this;$("#tour_dialog").fadeOut(function(){b.nextStep();this.inProgress=true})},tourComplete:function(){$("#tour_dialog").fadeOut();if(this.curStop==a.length){$("#tour_mask").fadeOut(function(){$(".tour_item").removeClass("active")});window.tourActive=false}},mpEvent:function(a){if(a){mixpanel.track(a,{funnelVersion:this.funnelID})}},getContent:function(){var b=a[this.curStop].msg;b+=a[this.curStop].btnMsg?"<hr><div id='tour_dialog_btn' class='button'>"+a[this.curStop].btnMsg+"</div>":"";b+=this.allowSkip?"<a id='tour_skip'>Skip Tour &raquo</a>":"";$("#tour_dialog .msg").html(b)},setDialogPos:function(b){var c=a[this.curStop].selector.split(",");var d=$(c[0]);var e=$("#tour_dialog");switch(b){case"top":var f=d.offset().top-e.outerHeight()-this.offsetFudge;var g=d.offset().left+d.outerWidth()/2-e.outerWidth()/2;break;case"right":var f=d.offset().top;var g=d.offset().left+d.outerWidth()+this.offsetFudge;break;case"bottom":var f=d.offset().top+d.outerHeight()+this.offsetFudge;var g=d.offset().left+d.outerWidth()/2-e.outerWidth()/2;break;case"left":var f=d.offset().top;var g=d.offset().left-e.outerWidth()-this.offsetFudge;break;case"center":var f=Math.max(0,($(window).height()-e.outerHeight())/2+$(window).scrollTop());var g=Math.max(0,($(window).width()-e.outerWidth())/2+$(window).scrollLeft());break}e.children(".arrow").attr("class","arrow "+b);e.css({top:f,left:g})},dialogVisible:function(){var a=$("#tour_dialog");var b=$(window).scrollTop();var c=b+$(window).height();var d=$(a).offset().top;var e=d+$(a).height();if(!(e>=b&&d<=c&&e<=c&&d>=b)){$("html, body").animate({scrollTop:$(a).offset().top-25},500)}},setupSelectorsLive:function(){var b=a[this.curStop].selector.split(",");for(var c=0;c<b.length;c++){$(b[c]).addClass("tour_item")}var d=a[this.curStop].waitForTrigger;if(d){$("body").append('<div id="'+d.substring(1)+'" style="display: none;"></div>');$(d).bind("click.tour",{selector:d},this.resumeClickHandler)}},resumeClickHandler:function(a){$(a.data.selector).unbind("click.tour",this.resumeClickHandler);b.showStep()},tourClickHandler:function(c){var d=a[c.data.stop].nextSelector;if(d){if($(c.currentTarget).is(d)||$(d).find(c.currentTarget).length>0){b.stepComplete()}}else{b.stepComplete()}}};b.init()}