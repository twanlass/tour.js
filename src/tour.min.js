function tourJS(d){var c={curStop:0,offsetFudge:15,allowSkip:false,funnelID:"tourV1",init:function(){window.tourActive=true;$("body").prepend('<div id="tour_mask"></div><div id="tour_dialog"><div class="arrow top"></div><div class="msg"></div></div>');this.showStep()},nextStep:function(){var a=d[this.curStop].waitForTrigger;this.curStop+=1;this.curStop<d.length&&!a?this.showStep():this.tourComplete()},showStep:function(){var a=this;this.setupSelectorsLive();$(".tour_item").removeClass("active");this.getContent();this.setDialogPos(d[this.curStop].position);$("*").bind("click",{stop:this.curStop},this.tourClickHandler);if(!$("#tour_mask").is(":visible")){$("#tour_mask").fadeIn()}$(d[this.curStop].selector).addClass("active").fadeIn();$("#tour_dialog").fadeIn(function(){a.dialogVisible()})},stepComplete:function(){this.mpEvent(d[this.curStop].actionName);$("*").unbind("click",this.tourClickHandler);var a=this;$("#tour_dialog").fadeOut(function(){a.nextStep();this.inProgress=true})},tourComplete:function(){$("#tour_dialog").fadeOut();if(this.curStop==d.length){$("#tour_mask").fadeOut(function(){$(".tour_item").removeClass("active")});window.tourActive=false}},mpEvent:function(b){if(b){mixpanel.track(b,{funnelVersion:this.funnelID})}},getContent:function(){var a=d[this.curStop].msg;a+=d[this.curStop].btnMsg?"<hr><div id='tour_dialog_btn' class='button'>"+d[this.curStop].btnMsg+"</div>":"";a+=this.allowSkip?"<a id='tour_skip'>Skip Tour &raquo</a>":"";$("#tour_dialog .msg").html(a)},setDialogPos:function(a){var l=d[this.curStop].selector.split(",");var k=$(l[0]);var j=$("#tour_dialog");switch(a){case"top":var i=k.offset().top-j.outerHeight()-this.offsetFudge;var h=k.offset().left+k.outerWidth()/2-j.outerWidth()/2;break;case"right":var i=k.offset().top;var h=k.offset().left+k.outerWidth()+this.offsetFudge;break;case"bottom":var i=k.offset().top+k.outerHeight()+this.offsetFudge;var h=k.offset().left+k.outerWidth()/2-j.outerWidth()/2;break;case"left":var i=k.offset().top;var h=k.offset().left-j.outerWidth()-this.offsetFudge;break;case"center":var i=Math.max(0,($(window).height()-j.outerHeight())/2+$(window).scrollTop());var h=Math.max(0,($(window).width()-j.outerWidth())/2+$(window).scrollLeft());break}j.children(".arrow").attr("class","arrow "+a);j.css({top:i,left:h})},dialogVisible:function(){var g=$("#tour_dialog");var f=$(window).scrollTop();var j=f+$(window).height();var i=$(g).offset().top;var h=i+$(g).height();if(!(h>=f&&i<=j&&h<=j&&i>=f)){$("html, body").animate({scrollTop:$(g).offset().top-25},500)}},setupSelectorsLive:function(){var a=d[this.curStop].selector.split(",");for(var f=0;f<a.length;f++){$(a[f]).addClass("tour_item")}var e=d[this.curStop].waitForTrigger;if(e){$("body").append('<div id="'+e.substring(1)+'" style="display: none;"></div>');$(e).bind("click.tour",{selector:e},this.resumeClickHandler)}},resumeClickHandler:function(b){$(b.data.selector).unbind("click.tour",this.resumeClickHandler);c.showStep()},tourClickHandler:function(b){var a=d[b.data.stop].nextSelector;if(a){if($(b.currentTarget).is(a)||$(a).find(b.currentTarget).length>0){c.stepComplete()}}else{c.stepComplete()}}};c.init()};