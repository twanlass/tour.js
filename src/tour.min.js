function tourJS(b){var a={curStop:0,offsetFudge:15,allowSkip:false,funnelID:"tourV1",init:function(){$("body").prepend('<div id="tour_mask"></div><div id="tour_dialog"><div class="arrow top"></div><div class="msg"></div></div>');this.showStep()},nextStep:function(){var c=b[this.curStop].waitForTrigger;this.curStop+=1;this.curStop<b.length&&!c?this.showStep():this.tourComplete()},showStep:function(){var c=this;this.setupSelectorsLive();$(".tour_item").removeClass("active");this.getContent();this.setDialogPos(b[this.curStop].position);$("*").bind("click",{stop:this.curStop},this.tourClickHandler);if(!$("#tour_mask").is(":visible")){$("#tour_mask").fadeIn()}$(b[this.curStop].selector).addClass("active").fadeIn();$("#tour_dialog").fadeIn(function(){c.dialogVisible()})},stepComplete:function(){this.mpEvent(b[this.curStop].actionName);$("*").unbind("click",this.tourClickHandler);var c=this;$("#tour_dialog").fadeOut(function(){c.nextStep();this.inProgress=true})},tourComplete:function(){$("#tour_dialog").fadeOut();if(this.curStop==b.length){$("#tour_mask").fadeOut(function(){$(".tour_item").removeClass("active")})}},mpEvent:function(c){if(c){mixpanel.track(c,{funnelVersion:this.funnelID})}},getContent:function(){var c=b[this.curStop].msg;c+=b[this.curStop].btnMsg?"<hr><div id='tour_dialog_btn' class='button'>"+b[this.curStop].btnMsg+"</div>":"";$("#tour_dialog .msg").html(c)},setDialogPos:function(c){var h=b[this.curStop].selector.split(",");var g=$(h[0]);var d=$("#tour_dialog");switch(c){case"top":var f=g.offset().top-d.outerHeight()-this.offsetFudge;var e=g.offset().left+g.outerWidth()/2-d.outerWidth()/2;break;case"right":var f=g.offset().top;var e=g.offset().left+g.outerWidth()+this.offsetFudge;break;case"bottom":var f=g.offset().top+g.outerHeight()+this.offsetFudge;var e=g.offset().left+g.outerWidth()/2-d.outerWidth()/2;break;case"left":var f=g.offset().top;var e=g.offset().left-d.outerWidth()-this.offsetFudge;break;case"center":var f=Math.max(0,(($(window).height()-d.outerHeight())/2)+$(window).scrollTop());var e=Math.max(0,(($(window).width()-d.outerWidth())/2)+$(window).scrollLeft());break}d.children(".arrow").attr("class","arrow "+c);d.css({top:f,left:e})},dialogVisible:function(){var e=$("#tour_dialog");var g=$(window).scrollTop();var f=g+$(window).height();var c=$(e).offset().top;var d=c+$(e).height();if(!((d>=g)&&(c<=f)&&(d<=f)&&(c>=g))){$("html, body").animate({scrollTop:$(e).offset().top-25},500)}},setupSelectorsLive:function(){var e=b[this.curStop].selector.split(",");for(var d=0;d<e.length;d++){$(e[d]).addClass("tour_item")}var c=b[this.curStop].waitForTrigger;if(c){$("body").append('<div id="'+c.substring(1)+'" style="display: none;"></div>');$(c).bind("click.tour",{selector:c},this.resumeClickHandler)}},resumeClickHandler:function(c){$(c.data.selector).unbind("click.tour",this.resumeClickHandler);a.showStep()},tourClickHandler:function(d){var c=b[d.data.stop].nextSelector;if(c){if($(d.currentTarget).is(c)||$(c).find(d.currentTarget).length>0){a.stepComplete()}}else{a.stepComplete()}}};a.init()};